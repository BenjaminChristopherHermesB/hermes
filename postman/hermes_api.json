{
    "info": {
        "name": "Hermes The Quizzer API",
        "description": "API collection for Hermes The Quizzer",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:3001/api"
        },
        {
            "key": "access_token",
            "value": ""
        },
        {
            "key": "refresh_token",
            "value": ""
        }
    ],
    "item": [
        {
            "name": "Auth",
            "item": [
                {
                    "name": "Register User",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"username\": \"testuser\",\n  \"password\": \"test123456\",\n  \"name\": \"Test User\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/register"
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const res = pm.response.json();",
                                    "if (res.accessToken) pm.collectionVariables.set('access_token', res.accessToken);",
                                    "if (res.refreshToken) pm.collectionVariables.set('refresh_token', res.refreshToken);",
                                    "pm.test('Status is 201', () => pm.response.to.have.status(201));",
                                    "pm.test('Returns tokens', () => { pm.expect(res.accessToken).to.exist; pm.expect(res.refreshToken).to.exist; });"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Login",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"username\": \"bchbenjamin\",\n  \"password\": \"Benjamin1312!\",\n  \"stayLoggedIn\": true\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/login"
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const res = pm.response.json();",
                                    "if (res.accessToken) pm.collectionVariables.set('access_token', res.accessToken);",
                                    "if (res.refreshToken) pm.collectionVariables.set('refresh_token', res.refreshToken);",
                                    "pm.test('Status is 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Returns user data', () => pm.expect(res.user).to.exist);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Login - Wrong Password",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"username\": \"bchbenjamin\",\n  \"password\": \"wrongpassword\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/login"
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status is 401', () => pm.response.to.have.status(401));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Refresh Token",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"refreshToken\": \"{{refresh_token}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/refresh"
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const res = pm.response.json();",
                                    "if (res.accessToken) pm.collectionVariables.set('access_token', res.accessToken);",
                                    "pm.test('Status is 200', () => pm.response.to.have.status(200));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Logout",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"refreshToken\": \"{{refresh_token}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/logout"
                        }
                    }
                }
            ]
        },
        {
            "name": "User",
            "item": [
                {
                    "name": "Get Profile",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/user/me"
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status is 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Has username', () => pm.expect(pm.response.json().username).to.exist);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Update Theme",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{ \"theme\": \"dark\" }"
                        },
                        "url": {
                            "raw": "{{base_url}}/user/theme"
                        }
                    }
                }
            ]
        },
        {
            "name": "Subjects",
            "item": [
                {
                    "name": "List Subjects",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/subjects"
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status is 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Returns array', () => pm.expect(pm.response.json()).to.be.an('array'));"
                                ]
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "Quiz",
            "item": [
                {
                    "name": "Start Quiz",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"subjectId\": 1,\n  \"questionCount\": 10,\n  \"isTimed\": false\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/quiz/start"
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const res = pm.response.json();",
                                    "pm.test('Status is 200', () => pm.response.to.have.status(200));",
                                    "pm.test('Has sessionId', () => pm.expect(res.sessionId).to.exist);",
                                    "pm.test('Has questions', () => pm.expect(res.questions).to.be.an('array'));"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Submit Answer",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"sessionId\": 1,\n  \"questionId\": 1,\n  \"selectedAnswer\": \"O(log n)\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/quiz/submit"
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const res = pm.response.json();",
                                    "pm.test('Has isCorrect', () => pm.expect(res.isCorrect).to.be.a('boolean'));",
                                    "pm.test('Has correctAnswer', () => pm.expect(res.correctAnswer).to.exist);"
                                ]
                            }
                        }
                    ]
                },
                {
                    "name": "Complete Quiz",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{ \"sessionId\": 1 }"
                        },
                        "url": {
                            "raw": "{{base_url}}/quiz/complete"
                        }
                    }
                },
                {
                    "name": "Review Quiz",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/quiz/review/1"
                        }
                    }
                },
                {
                    "name": "Quiz History",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/quiz/history?page=1&limit=10"
                        }
                    }
                }
            ]
        },
        {
            "name": "Admin",
            "item": [
                {
                    "name": "Get Stats",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/admin/stats"
                        }
                    }
                },
                {
                    "name": "List Users",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/admin/users"
                        }
                    }
                },
                {
                    "name": "Upload Subject",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"subject\": \"Test Subject\",\n  \"questions\": [\n    {\n      \"question\": \"Test question?\",\n      \"options\": [\"A\", \"B\", \"C\", \"D\"],\n      \"correct_answer\": \"B\",\n      \"explanation\": \"Because B is correct.\",\n      \"module\": 1\n    }\n  ]\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/admin/subjects/upload"
                        }
                    }
                },
                {
                    "name": "Export Subject",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/admin/subjects/1/export"
                        }
                    }
                },
                {
                    "name": "Promote User",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{ \"role\": \"admin\" }"
                        },
                        "url": {
                            "raw": "{{base_url}}/admin/users/2/role"
                        }
                    }
                },
                {
                    "name": "Reset Password",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{access_token}}"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{ \"newPassword\": \"newpassword123\" }"
                        },
                        "url": {
                            "raw": "{{base_url}}/admin/users/2/reset-password"
                        }
                    }
                },
                {
                    "name": "Non-Admin Access (expect 403)",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer invalid_token"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/admin/stats"
                        }
                    },
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('Status is 401 or 403', () => { pm.expect([401, 403]).to.include(pm.response.code); });"
                                ]
                            }
                        }
                    ]
                }
            ]
        }
    ]
}